{"version":3,"file":"shopee-link/index.js","mappings":"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","sources":["webpack://rb-gutenberg-blocks/./src/shopee-link/edit.js","webpack://rb-gutenberg-blocks/external window \"React\"","webpack://rb-gutenberg-blocks/external window [\"wp\",\"blockEditor\"]","webpack://rb-gutenberg-blocks/external window [\"wp\",\"blocks\"]","webpack://rb-gutenberg-blocks/external window [\"wp\",\"components\"]","webpack://rb-gutenberg-blocks/external window [\"wp\",\"data\"]","webpack://rb-gutenberg-blocks/external window [\"wp\",\"element\"]","webpack://rb-gutenberg-blocks/external window [\"wp\",\"url\"]","webpack://rb-gutenberg-blocks/webpack/bootstrap","webpack://rb-gutenberg-blocks/webpack/runtime/compat get default export","webpack://rb-gutenberg-blocks/webpack/runtime/define property getters","webpack://rb-gutenberg-blocks/webpack/runtime/hasOwnProperty shorthand","webpack://rb-gutenberg-blocks/webpack/runtime/make namespace object","webpack://rb-gutenberg-blocks/./src/shopee-link/index.js"],"sourcesContent":["import {\n\tPanelBody,\n} from '@wordpress/components';\nimport { \n\twithSelect,\n\tuseDispatch \n} from '@wordpress/data';\nimport { \n\tInnerBlocks, \n\tInspectorControls,\n\tuseBlockProps,\n\tuseInnerBlocksProps,\n\tstore\n} from '@wordpress/block-editor';\nimport { isURL } from '@wordpress/url';\nimport { createBlocksFromInnerBlocksTemplate } from '@wordpress/blocks';\n \nimport { \n\t__experimentalInputControl as InputControl,\n\t__experimentalVStack as VStack,\n\t__experimentalHStack as HStack,\n\t__experimentalText as Text,\n} from '@wordpress/components';\nimport { \n\tuseEffect, \n\tuseMemo\n} from '@wordpress/element';\n\nimport defaultTemplate from './template.json';\n\nexport const getTemplate = ({ image = 'http://placehold.it/80x100?text=img', url = '', message = 'Your message go here'}) => {\n\tlet templateString = JSON.stringify(defaultTemplate);\n\ttemplateString = templateString\n\t\t.replaceAll('{{link}}', url)\n\t\t.replaceAll('{{message}}', message)\n\t\t.replaceAll('{{image}}', image);\n\n\treturn JSON.parse(templateString);\n}\n\nconst ChildBlocks = withSelect(( select, ownProps ) => {\n\tconst blocks = select( 'core/block-editor' ).getBlocks( ownProps.clientId );\n\tlet image = '';\n\tlet message = '';\n\tconst getBlockValue = (block, name, field) => {\n\t\tlet value = false;\n\t\tblock.innerBlocks.forEach(child => {\n\t\t\tif ( value ) return; // Skip\n\t\t\tif ( child.name === name ) {\n\t\t\t\tvalue = child.attributes[field];\n\t\t\t} else if ( !!child.innerBlocks && child.innerBlocks.length > 0 ) {\n\t\t\t\tvalue = getBlockValue(child, name, field)\n\t\t\t}\n\t\t})\n\t\treturn value;\n\t}\n\tif ( blocks.length > 0 ) {\n\t\t// Just get innerBlock data\n\t\timage = getBlockValue(blocks[0], 'core/image', 'url');\n\t\tmessage = getBlockValue(blocks[0], 'core/navigation-link', 'label')\n\t}\n\treturn {\n\t\timage,\n\t\tmessage\n\t};\n} )(({ attributes, clientId, onChange, image, message }) => {\n\t\n\tuseEffect(() => {\n\t\tif ( !image || !message ) return;\n\t\tif ( typeof onChange === 'function' && (image != attributes.image || message != attributes.message) ) {\n\t\t\tonChange({ image, message });\n\t\t}\n\t}, [image, message])\n\n\treturn (\n\t\t<>\n\t\t\t<InnerBlocks template={getTemplate(attributes)} />\n\t\t</>\n\t)\n});\n\n\nconst Edit = ({ clientId, attributes, setAttributes}) => {\n\tconst { replaceInnerBlocks } = useDispatch( store );\n\n\tconst updateBlockAttrs = async ({ url }) => {\n\t\tlet attrs = {}\n\t\tif ( isURL(url) ) {\n\t\t\tconst response = await fetch(\n\t\t\t\twindow.wpApiSettings.root + 'rb-blocks/v1/shopee?link=' + url,\n\t\t\t\t{ headers: { 'X-WP-Nonce': wpApiSettings.nonce } }) \n\t\t\t\t.then(data => data.json());\n\t\t\tif ( response.status === 'success' ) {\n\t\t\t\tif ( !!response?.data?.name ) {\n\t\t\t\t\tattrs.message = response.data.name;\n\t\t\t\t}\n\t\t\t\tif ( !!response?.data?.images ) {\n\t\t\t\t\tattrs.image = response?.data?.images[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\tattrs.url = url;\n\t\t}\n\n\t\t// Rerender blocks\n\t\t!!window.timeoutRenderBlocks && clearTimeout(window.timeoutRenderBlocks);\n\t\twindow.timeoutRenderBlocks = setTimeout(() => {\n\t\t\tsetAttributes(attrs)\n\t\t\treplaceInnerBlocks(\n\t\t\t\tclientId, \n\t\t\t\tcreateBlocksFromInnerBlocksTemplate(getTemplate({\n\t\t\t\t\t...attributes,\n\t\t\t\t\t...attrs\n\t\t\t\t}))\n\t\t\t);\n\t\t\twindow.timeoutRenderBlocks = false;\n\t\t}, 1000);\n\t}\n\tconst changeHandle = (newValue = '') => {\n\t\tupdateBlockAttrs({ url: newValue });\t\n\t}\n\t\n\treturn (\n\t\t<>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody title={ 'Settings' }>\n\t\t\t\t\t\t<InputControl\n\t\t\t\t\t\t\tlabel={\"Product Link\"}\n\t\t\t\t\t\t\tvalue={attributes.url}\n\t\t\t\t\t\t\tonChange={changeHandle}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t\t\n\t\t\t\t</InspectorControls>\n\t\t\t\t{!!attributes.url && \n\t\t\t\t\t<ChildBlocks \n\t\t\t\t\t\tclientId={clientId} \n\t\t\t\t\t\tattributes={attributes} \n\t\t\t\t\t\tonChange={( attrs ) => {\n\t\t\t\t\t\t\tsetAttributes(attrs);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/> }\n\t\t</>\n\t)\n}\n\nexport default Edit;","module.exports = window[\"React\"];","module.exports = window[\"wp\"][\"blockEditor\"];","module.exports = window[\"wp\"][\"blocks\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"url\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { registerBlockType } from '@wordpress/blocks';\nimport metadata from './block.json';\nimport Edit from './edit';\n// Register the block\nregisterBlockType(metadata, {\n\tedit: Edit,\n\tsave: () => null // Nil becuz this is dynamic block\n});"],"names":["PanelBody","withSelect","useDispatch","InnerBlocks","InspectorControls","useBlockProps","useInnerBlocksProps","store","isURL","createBlocksFromInnerBlocksTemplate","__experimentalInputControl","InputControl","__experimentalVStack","VStack","__experimentalHStack","HStack","__experimentalText","Text","useEffect","useMemo","defaultTemplate","getTemplate","image","url","message","templateString","JSON","stringify","replaceAll","parse","ChildBlocks","select","ownProps","blocks","getBlocks","clientId","getBlockValue","block","name","field","value","innerBlocks","forEach","child","attributes","length","onChange","createElement","Fragment","template","Edit","setAttributes","replaceInnerBlocks","updateBlockAttrs","attrs","response","fetch","window","wpApiSettings","root","headers","nonce","then","data","json","status","images","timeoutRenderBlocks","clearTimeout","setTimeout","changeHandle","newValue","title","label","registerBlockType","metadata","edit","save"],"sourceRoot":""}