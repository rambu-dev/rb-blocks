!function(){"use strict";var e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"rb-blocks/shopee-link","version":"0.1.0","title":"RB Embed Shopee Link","category":"common","icon":"smiley","description":"A block to quick share shopee link with auto generate thumbnail and description.","supports":{"html":true},"attributes":{"url":{"type":"string"},"image":{"type":"string"},"message":{"type":"string"},"variations":{"type":"array"}},"textdomain":"rb-blocks","editorScript":"file:./index.js"}'),n=window.React,o=window.wp.components,a=window.wp.data,i=window.wp.blockEditor,r=window.wp.url,l=window.wp.element,s=JSON.parse('[["core/group",{"layout":{"type":"flex","orientation":"horizontal","justifyContent":"stretch","flexWrap":"nowrap","allowSizingOnChildren":true},"style":{"spacing":{"padding":{"top":"12px","bottom":"12px","left":"12px","right":"12px"},"blockGap":"12px"},"border":{"radius":"12px"},"alignItems":"stretch"},"backgroundColor":"base","lock":"all","allowedBlocks":["core/image","core/group","core/button","core/buttons","core/navigation-link"]},[["core/image",{"url":"{{image}}","width":"80px","href":"{{link}}","linkTarget":"_blank","rel":"noreferrer","aspectRatio":"0.75","object-fit":"cover","style":{"border":{"radius":"12px"}},"scale":"cover"}],["core/group",{"layout":{"type":"flex","orientation":"vertical","justifyContent":"stretch","flexWrap":"wrap","allowSizingOnChildren":true,"verticalAlignment":"space-between"},"style":{"layout":{"selfStretch":"fill"}}},[["core/navigation-link",{"url":"{{link}}","linkTarget":"_blank","label":"{{message}}","rel":"noreferrer","title":"{{message}}"}],["core/buttons",{"layout":{"type":"flex","justifyContent":"right"}},[["core/button",{"text":"xem","url":"{{link}}","fontSize":"small","style":{"border":{"radius":"4px"}}}]]]]]]]]');const c=({image:e="http://placehold.it/80x100?text=img",url:t="",message:n="Your message go here",variations:o=!1})=>{let a=JSON.stringify(s),i=n;return o&&o.length>0&&o[0].options.forEach((e=>{e.selected&&(i+=` (${e.name})`)})),a=a.replaceAll("{{link}}",t).replaceAll("{{message}}",i).replaceAll("{{image}}",e),JSON.parse(a)},p=(0,a.withSelect)(((e,t)=>{const n=e("core/block-editor").getBlocks(t.clientId);let o="",a="";const i=(e,t,n)=>{let o=!1;return e.innerBlocks.forEach((e=>{o||(e.name===t?o=e.attributes[n]:e.innerBlocks&&e.innerBlocks.length>0&&(o=i(e,t,n)))})),o};return n.length>0&&(o=i(n[0],"core/image","url"),a=i(n[0],"core/navigation-link","label")),{image:o,message:a}}))((({attributes:e,clientId:t,onChange:o,image:a,message:r})=>((0,l.useEffect)((()=>{a&&r&&("function"!=typeof o||a==e.image&&r==e.message||o({image:a,message:r}))}),[a,r]),(0,n.createElement)(i.InnerBlocks,{template:c(e)}))));(0,e.registerBlockType)(t,{edit:({clientId:t,attributes:s,setAttributes:m})=>{const{replaceInnerBlocks:g}=(0,a.useDispatch)(i.store),[u,d]=(0,l.useState)(s?.image),k=async n=>{const{url:o=!1}=n;if(o&&(0,r.isURL)(o)){const e=await fetch(window.wpApiSettings.root+"rb-blocks/v1/shopee?link="+o,{headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then((e=>e.json()));"success"===e.status&&(e?.data?.name&&(n.message=e.data.name),e?.data?.images&&(n.image=e?.data?.images[0]),e?.data?.variations&&(n.variations=e?.data?.variations)),n.url=o}window.timeoutRenderBlocks&&clearTimeout(window.timeoutRenderBlocks),window.timeoutRenderBlocks=setTimeout((()=>{m(n),g(t,(0,e.createBlocksFromInnerBlocksTemplate)(c({...s,...n}))),window.timeoutRenderBlocks=!1}),1e3)};return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(i.InspectorControls,null,(0,n.createElement)(o.PanelBody,{title:"Settings"},(0,n.createElement)(o.__experimentalInputControl,{label:"Product Link",value:s.url,onChange:(e="")=>{k({url:e})}}),!!s.variations&&s.variations.length>0&&(0,n.createElement)(o.SelectControl,{label:`Options ${s.variations[0].title}`,value:u,options:s.variations[0].options.map((e=>({label:e.name,value:e.image||!1}))),onChange:e=>{(0,r.isURL)(e)&&(d(e),s.variations[0].options.map((t=>(t.selected=t.image===e,t))),console.log(s.variations),k({image:e,variations:s.variations}))},__nextHasNoMarginBottom:!0}))),!!s.url&&(0,n.createElement)(p,{clientId:t,attributes:s,onChange:e=>{m(e)}}))},save:()=>null})}();